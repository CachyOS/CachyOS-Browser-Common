# Cachy firefox-view.patch
#
# Author:        Malte JÃ¼rgens <maltejur@dismail.de>
# Description:   Hide "Firefox View" by default
# Last Updated:  2023-11-04
# License:       MPL 2.0
#
# This patch removes the Firefox View from the toolbar by default. Users can
# enable it again by using the "Customize Toolbar" mode and dragging it back to
# the titlebar.
--- a/browser/base/content/browser.js
+++ b/browser/base/content/browser.js
@@ -9940,10 +9940,11 @@ var FirefoxViewHandler = {
       !this._enabled
     );
     document.getElementById("menu_openFirefoxView").hidden = !this._enabled;
-    document.getElementById("firefox-view-button").style.listStyleImage =
-      NimbusFeatures.firefoxViewNext.getVariable("newIcon")
-        ? ""
-        : 'url("chrome://branding/content/about-logo.png")';
+    if (this.button)
+      this.button.style.listStyleImage =
+        NimbusFeatures.firefoxViewNext.getVariable("newIcon")
+          ? ""
+          : 'url("chrome://branding/content/about-logo.png")';
   },
   onWidgetRemoved(aWidgetId) {
     if (aWidgetId == this.BUTTON_ID && this.tab) {
--- a/browser/base/content/navigator-toolbox.inc.xhtml
+++ b/browser/base/content/navigator-toolbox.inc.xhtml
@@ -35,16 +35,6 @@
       <hbox flex="1" align="end" class="toolbar-items">
         <toolbartabstop/>
         <hbox id="TabsToolbar-customization-target" flex="1">
-          <toolbarbutton id="firefox-view-button"
-                         class="toolbarbutton-1 chromeclass-toolbar-additional"
-                         data-l10n-id="toolbar-button-firefox-view-2"
-                         role="button"
-                         aria-pressed="false"
-                         oncommand="FirefoxViewHandler.openTab(event);"
-                         onmousedown="FirefoxViewHandler.openTab(event);"
-                         cui-areatype="toolbar"
-                         removable="true"/>
-
           <tabs id="tabbrowser-tabs"
                 is="tabbrowser-tabs"
                 aria-multiselectable="true"
@@ -712,5 +702,15 @@
                    closemenu="none"
                    cui-areatype="toolbar"
                    data-l10n-id="navbar-library"/>
+
+    <toolbarbutton id="firefox-view-button"
+                   class="toolbarbutton-1 chromeclass-toolbar-additional"
+                   data-l10n-id="toolbar-button-firefox-view-2"
+                   role="button"
+                   aria-pressed="false"
+                   oncommand="FirefoxViewHandler.openTab(event);"
+                   onmousedown="FirefoxViewHandler.openTab(event);"
+                   cui-areatype="toolbar"
+                   removable="true"/>
   </html:template>
 </toolbox>
--- a/browser/components/customizableui/CustomizableUI.sys.mjs
+++ b/browser/components/customizableui/CustomizableUI.sys.mjs
@@ -287,7 +287,6 @@ var CustomizableUIInternal = {
       {
         type: CustomizableUI.TYPE_TOOLBAR,
         defaultPlacements: [
-          "firefox-view-button",
           "tabbrowser-tabs",
           "new-tab-button",
           "alltabs-button",
@@ -616,18 +615,6 @@ var CustomizableUIInternal = {
       }
     }
 
-    // Add firefox-view if not present
-    if (currentVersion < 18) {
-      let tabstripPlacements =
-        gSavedState.placements[CustomizableUI.AREA_TABSTRIP];
-      if (
-        tabstripPlacements &&
-        !tabstripPlacements.includes("firefox-view-button")
-      ) {
-        tabstripPlacements.unshift("firefox-view-button");
-      }
-    }
-
     // Unified Extensions addon button migration, which puts any browser action
     // buttons in the overflow menu into the addons panel instead.
     if (currentVersion < 19) {
--- a/browser/components/firefoxview/firefoxview.html
+++ b/browser/components/firefoxview/firefoxview.html
@@ -61,6 +61,7 @@
         is="tab-pickup-container"
         id="tab-pickup-container"
         open
+	hidden
       >
         <summary class="page-section-header">
           <span
